import{Op as e,$pc as t,CurriedTypes as n,$t0 as s,$t1 as i,InternalComponentCapabilities as r,$sp as a,$v0 as l,ContentType as o,CurriedType as u,$ra as c,$fp as p,MachineOp as d,isLowLevelRegister as h,$s1 as m,$s0 as f}from"@glimmer/vm";import{UNDEFINED_REFERENCE as g,createComputeRef as b,valueForRef as k,createConstRef as y,createPrimitiveRef as v,isConstRef as S,NULL_REFERENCE as w,TRUE_REFERENCE as E,FALSE_REFERENCE as C,childRefFor as x,createIteratorRef as N,isInvokableRef as T,updateRef as _,createIteratorItemRef as B}from"@glimmer/reference";import{assign as R,unwrap as A,expect as M,NS_SVG as O,castToBrowser as D,Stack as L,assert as V,isObject as U,decodeHandle as I,isHandle as H,decodeImmediate as P,EMPTY_STRING_ARRAY as G,dict as j,unwrapTemplate as z,enumerate as F,emptyArray as W,INSERT_BEFORE_END as $,INSERT_BEFORE_BEGIN as Y,clearElement as J,INSERT_AFTER_BEGIN as K,castToSimple as q,buildUntouchableThis as X,isDict as Q,unwrapHandle as Z,reverse as ee,COMMENT_NODE as te}from"@glimmer/util";import{registerDestructor as ne,destroy as se,associateDestroyableChild as ie,_hasDestroyableChildren as re,destroyChildren as ae}from"@glimmer/destroyable";export{destroy,isDestroyed,isDestroying,registerDestructor}from"@glimmer/destroyable";import{toBool as le,getPath as oe,setPath as ue}from"@glimmer/global-context";import{getInternalModifierManager as ce,managerHasCapability as pe,getInternalHelperManager as de,hasInternalComponentManager as he,hasInternalHelperManager as me,setInternalComponentManager as fe,setInternalHelperManager as ge,hasValue as be,hasDestroyable as ke,setInternalModifierManager as ye}from"@glimmer/manager";import{beginTrackFrame as ve,endTrackFrame as Se,CONSTANT_TAG as we,INITIAL as Ee,validateTag as Ce,consumeTag as xe,valueForTag as Ne,CURRENT_TAG as Te,track as _e,updateTag as Be,createCache as Re,getValue as Ae,createUpdatableTag as Me}from"@glimmer/validator";import{RuntimeProgramImpl as Oe}from"@glimmer/program";import{getOwner as De}from"@glimmer/owner";new Array(e.Size).fill(null),new Array(e.Size).fill(null);class Le{bucket;constructor(e){this.bucket=e?R({},e):{}}get(e){return A(this.bucket[e])}set(e,t){return this.bucket[e]=t}child(){return new Le(this.bucket)}}class Ve{static root(e,t=0,n){let s=new Array(t+1).fill(g);return new Ve(s,n,null,null,null).init({self:e})}static sized(e=0,t){let n=new Array(e+1).fill(g);return new Ve(n,t,null,null,null)}constructor(e,t,n,s,i){this.slots=e,this.owner=t,this.callerScope=n,this.evalScope=s,this.partialMap=i}init({self:e}){return this.slots[0]=e,this}getSelf(){return this.get(0)}getSymbol(e){return this.get(e)}getBlock(e){let t=this.get(e);return t===g?null:t}getEvalScope(){return this.evalScope}getPartialMap(){return this.partialMap}bind(e,t){this.set(e,t)}bindSelf(e){this.set(0,e)}bindSymbol(e,t){this.set(e,t)}bindBlock(e,t){this.set(e,t)}bindEvalScope(e){this.evalScope=e}bindPartialMap(e){this.partialMap=e}bindCallerScope(e){this.callerScope=e}getCallerScope(){return this.callerScope}child(){return new Ve(this.slots.slice(),this.owner,this.callerScope,this.evalScope,this.partialMap)}get(e){if(e>=this.slots.length)throw new RangeError(`BUG: cannot get $${e} from scope; length=${this.slots.length}`);return this.slots[e]}set(e,t){if(e>=this.slots.length)throw new RangeError(`BUG: cannot get $${e} from scope; length=${this.slots.length}`);this.slots[e]=t}}const Ue=Symbol("INNER_VM"),Ie=Symbol("DESTROYABLE_STACK"),He=Symbol("STACKS"),Pe=Symbol("REGISTERS"),Ge=Symbol("HEAP"),je=Symbol("CONSTANTS"),ze=Symbol("ARGS");class Fe{constructor(e,t){this.element=e,this.nextSibling=t}}class We{constructor(e,t,n){this.parentNode=e,this.first=t,this.last=n}parentElement(){return this.parentNode}firstNode(){return this.first}lastNode(){return this.last}}function $e(e,t){let n=e.parentElement(),s=e.firstNode(),i=e.lastNode(),r=s;for(;;){let e=r.nextSibling;if(n.insertBefore(r,t),r===i)return e;r=M(e,"invalid bounds")}}function Ye(e){let t=e.parentElement(),n=e.firstNode(),s=e.lastNode(),i=n;for(;;){let e=i.nextSibling;if(t.removeChild(i),i===s)return e;i=M(e,"invalid bounds")}}function Je(e){return Ke(e)?"":String(e)}function Ke(e){return null==e||"function"!=typeof e.toString}function qe(e){return"object"==typeof e&&null!==e&&"function"==typeof e.toHTML}function Xe(e){return"object"==typeof e&&null!==e&&"number"==typeof e.nodeType}function Qe(e){return"string"==typeof e}function Ze(e,t){let n,s;if(t in e)s=t,n="prop";else{let i=t.toLowerCase();i in e?(n="prop",s=i):(n="attr",s=t)}return"prop"!==n||"style"!==s.toLowerCase()&&!function(e,t){let n=et[e.toUpperCase()];return n&&n[t.toLowerCase()]||!1}(e.tagName,s)||(n="attr"),{normalized:s,type:n}}const et={INPUT:{form:!0,autocorrect:!0,list:!0},SELECT:{form:!0},OPTION:{form:!0},TEXTAREA:{form:!0},LABEL:{form:!0},FIELDSET:{form:!0},LEGEND:{form:!0},OBJECT:{form:!0},OUTPUT:{form:!0},BUTTON:{form:!0}},tt=["javascript:","vbscript:"],nt=["A","BODY","LINK","IMG","IFRAME","BASE","FORM"],st=["EMBED"],it=["href","src","background","action"],rt=["src"];function at(e,t){return-1!==e.indexOf(t)}function lt(e,t){return(null===e||at(nt,e))&&at(it,t)}function ot(e,t){return null!==e&&at(st,e)&&at(rt,t)}function ut(e,t){return lt(e,t)||ot(e,t)}let ct;function pt(e,t,n){let s=null;if(null==n)return n;if(qe(n))return n.toHTML();s=e?e.tagName.toUpperCase():null;let i=Je(n);if(lt(s,t)){let e=(r=i,ct||(ct=function(){if("object"==typeof URL&&null!==URL&&"function"==typeof URL.parse){let e=URL;return t=>{let n=null;return"string"==typeof t&&(n=e.parse(t).protocol),null===n?":":n}}if("function"==typeof URL)return e=>{try{return new URL(e).protocol}catch(e){return":"}};throw new Error('@glimmer/runtime needs a valid "globalThis.URL"')}()),ct(r));if(at(tt,e))return`unsafe:${i}`}var r;return ot(s,t)?`unsafe:${i}`:i}function dt(e,t,n,s=!1){const{tagName:i,namespaceURI:r}=e,a={element:e,name:t,namespace:n};if(r===O)return ht(i,t,a);const{type:l,normalized:o}=Ze(e,t);return"attr"===l?ht(i,o,a):function(e,t,n){return ut(e,t)?new bt(t,n):function(e,t){return("INPUT"===e||"TEXTAREA"===e)&&"value"===t}(e,t)?new yt(t,n):function(e,t){return"OPTION"===e&&"selected"===t}(e,t)?new vt(t,n):new gt(t,n)}(i,o,a)}function ht(e,t,n){return ut(e,t)?new kt(n):new ft(n)}class mt{constructor(e){this.attribute=e}}class ft extends mt{set(e,t,n){const s=St(t);if(null!==s){const{name:t,namespace:n}=this.attribute;e.__setAttribute(t,s,n)}}update(e,t){const n=St(e),{element:s,name:i}=this.attribute;null===n?s.removeAttribute(i):s.setAttribute(i,n)}}class gt extends mt{constructor(e,t){super(t),this.normalizedName=e}value;set(e,t,n){null!=t&&(this.value=t,e.__setProperty(this.normalizedName,t))}update(e,t){const{element:n}=this.attribute;this.value!==e&&(n[this.normalizedName]=this.value=e,null==e&&this.removeAttribute())}removeAttribute(){const{element:e,namespace:t}=this.attribute;t?e.removeAttributeNS(t,this.normalizedName):e.removeAttribute(this.normalizedName)}}class bt extends gt{set(e,t,n){const{element:s,name:i}=this.attribute,r=pt(s,i,t);super.set(e,r,n)}update(e,t){const{element:n,name:s}=this.attribute,i=pt(n,s,e);super.update(i,t)}}class kt extends ft{set(e,t,n){const{element:s,name:i}=this.attribute,r=pt(s,i,t);super.set(e,r,n)}update(e,t){const{element:n,name:s}=this.attribute,i=pt(n,s,e);super.update(i,t)}}class yt extends gt{set(e,t){e.__setProperty("value",Je(t))}update(e){const t=D(this.attribute.element,["input","textarea"]),n=t.value,s=Je(e);n!==s&&(t.value=s)}}class vt extends gt{set(e,t){null!=t&&!1!==t&&e.__setProperty("selected",!0)}update(e){D(this.attribute.element,"option").selected=!!e}}function St(e){return!1===e||null==e||void 0===e.toString?null:!0===e?"":"function"==typeof e?null:String(e)}class wt{constructor(e){this.node=e}firstNode(){return this.node}}class Et{constructor(e){this.node=e}lastNode(){return this.node}}const Ct=Symbol("CURSOR_STACK");class xt{dom;updateOperations;constructing=null;operations=null;env;[Ct]=new L;modifierStack=new L;blockStack=new L;static forInitialRender(e,t){return new this(e,t.element,t.nextSibling).initialize()}static resume(e,t){let n=new this(e,t.parentElement(),t.reset(e)).initialize();return n.pushLiveBlock(t),n}constructor(e,t,n){this.pushElement(t,n),this.env=e,this.dom=e.getAppendOperations(),this.updateOperations=e.getDOM()}initialize(){return this.pushSimpleBlock(),this}debugBlocks(){return this.blockStack.toArray()}get element(){return this[Ct].current.element}get nextSibling(){return this[Ct].current.nextSibling}get hasBlocks(){return this.blockStack.size>0}block(){return M(this.blockStack.current,"Expected a current live block")}popElement(){this[Ct].pop(),M(this[Ct].current,"can't pop past the last element")}pushSimpleBlock(){return this.pushLiveBlock(new Nt(this.element))}pushUpdatableBlock(){return this.pushLiveBlock(new _t(this.element))}pushBlockList(e){return this.pushLiveBlock(new Bt(this.element,e))}pushLiveBlock(e,t=!1){let n=this.blockStack.current;return null!==n&&(t||n.didAppendBounds(e)),this.__openBlock(),this.blockStack.push(e),e}popBlock(){return this.block().finalize(this),this.__closeBlock(),M(this.blockStack.pop(),"Expected popBlock to return a block")}__openBlock(){}__closeBlock(){}openElement(e){let t=this.__openElement(e);return this.constructing=t,t}__openElement(e){return this.dom.createElement(e,this.element)}flushElement(e){let t=this.element,n=M(this.constructing,"flushElement should only be called when constructing an element");this.__flushElement(t,n),this.constructing=null,this.operations=null,this.pushModifiers(e),this.pushElement(n,null),this.didOpenElement(n)}__flushElement(e,t){this.dom.insertBefore(e,t,this.nextSibling)}closeElement(){return this.willCloseElement(),this.popElement(),this.popModifiers()}pushRemoteElement(e,t,n){return this.__pushRemoteElement(e,t,n)}__pushRemoteElement(e,t,n){if(this.pushElement(e,n),void 0===n)for(;e.lastChild;)e.removeChild(e.lastChild);let s=new Tt(e);return this.pushLiveBlock(s,!0)}popRemoteElement(){const e=this.popBlock();return V(e instanceof Tt,"[BUG] expecting a RemoteLiveBlock"),this.popElement(),e}pushElement(e,t=null){this[Ct].push(new Fe(e,t))}pushModifiers(e){this.modifierStack.push(e)}popModifiers(){return this.modifierStack.pop()}didAppendBounds(e){return this.block().didAppendBounds(e),e}didAppendNode(e){return this.block().didAppendNode(e),e}didOpenElement(e){return this.block().openElement(e),e}willCloseElement(){this.block().closeElement()}appendText(e){return this.didAppendNode(this.__appendText(e))}__appendText(e){let{dom:t,element:n,nextSibling:s}=this,i=t.createTextNode(e);return t.insertBefore(n,i,s),i}__appendNode(e){return this.dom.insertBefore(this.element,e,this.nextSibling),e}__appendFragment(e){let t=e.firstChild;if(t){let n=new We(this.element,t,e.lastChild);return this.dom.insertBefore(this.element,e,this.nextSibling),n}{const e=this.__appendComment("");return new We(this.element,e,e)}}__appendHTML(e){return this.dom.insertHTMLBefore(this.element,this.nextSibling,e)}appendDynamicHTML(e){let t=this.trustedContent(e);this.didAppendBounds(t)}appendDynamicText(e){let t=this.untrustedContent(e);return this.didAppendNode(t),t}appendDynamicFragment(e){let t=this.__appendFragment(e);this.didAppendBounds(t)}appendDynamicNode(e){let t=this.__appendNode(e),n=new We(this.element,t,t);this.didAppendBounds(n)}trustedContent(e){return this.__appendHTML(e)}untrustedContent(e){return this.__appendText(e)}appendComment(e){return this.didAppendNode(this.__appendComment(e))}__appendComment(e){let{dom:t,element:n,nextSibling:s}=this,i=t.createComment(e);return t.insertBefore(n,i,s),i}__setAttribute(e,t,n){this.dom.setAttribute(this.constructing,e,t,n)}__setProperty(e,t){this.constructing[e]=t}setStaticAttribute(e,t,n){this.__setAttribute(e,t,n)}setDynamicAttribute(e,t,n,s){let i=dt(this.constructing,e,s,n);return i.set(this,t,this.env),i}}class Nt{first=null;last=null;nesting=0;constructor(e){this.parent=e}parentElement(){return this.parent}firstNode(){return M(this.first,"cannot call `firstNode()` while `SimpleLiveBlock` is still initializing").firstNode()}lastNode(){return M(this.last,"cannot call `lastNode()` while `SimpleLiveBlock` is still initializing").lastNode()}openElement(e){this.didAppendNode(e),this.nesting++}closeElement(){this.nesting--}didAppendNode(e){0===this.nesting&&(this.first||(this.first=new wt(e)),this.last=new Et(e))}didAppendBounds(e){0===this.nesting&&(this.first||(this.first=e),this.last=e)}finalize(e){null===this.first&&e.appendComment("")}}class Tt extends Nt{constructor(e){super(e),ne(this,(()=>{this.parentElement()===this.firstNode().parentNode&&Ye(this)}))}}class _t extends Nt{reset(){se(this);let e=Ye(this);return this.first=null,this.last=null,this.nesting=0,e}}class Bt{constructor(e,t){this.parent=e,this.boundList=t,this.parent=e,this.boundList=t}parentElement(){return this.parent}firstNode(){return M(this.boundList[0],"cannot call `firstNode()` while `LiveBlockList` is still initializing").firstNode()}lastNode(){let e=this.boundList;return M(e[e.length-1],"cannot call `lastNode()` while `LiveBlockList` is still initializing").lastNode()}openElement(e){V(!1,"Cannot openElement directly inside a block list")}closeElement(){V(!1,"Cannot closeElement directly inside a block list")}didAppendNode(e){V(!1,"Cannot create a new node directly inside a block list")}didAppendBounds(e){}finalize(e){V(this.boundList.length>0,"boundsList cannot be empty")}}function Rt(e,t){return xt.forInitialRender(e,t)}const At=new class{evaluateOpcode=new Array(e.Size).fill(null);add(e,t,n="syscall"){this.evaluateOpcode[e]={syscall:"machine"!==n,evaluate:t}}debugBefore(e,n){return{sp:void 0,pc:e.fetchValue(t),name:void 0,params:void 0,type:n.type,isMachine:n.isMachine,size:n.size,state:void 0}}debugAfter(e,t){}evaluate(e,t,n){let s=A(this.evaluateOpcode[n]);s.syscall?(V(!t.isMachine,`BUG: Mismatch between operation.syscall (${s.syscall}) and opcode.isMachine (${t.isMachine}) for ${t.type}`),s.evaluate(e,t)):(V(t.isMachine,`BUG: Mismatch between operation.syscall (${s.syscall}) and opcode.isMachine (${t.isMachine}) for ${t.type}`),s.evaluate(e[Ue],t))}},Mt=Symbol("TYPE"),Ot=Symbol("INNER"),Dt=Symbol("OWNER"),Lt=Symbol("ARGS"),Vt=Symbol("RESOLVED"),Ut=new WeakSet;function It(e){return Ut.has(e)}function Ht(e,t){return It(e)&&e[Mt]===t}class Pt{[Mt];[Ot];[Dt];[Lt];[Vt];constructor(e,t,n,s,i=!1){Ut.add(this),this[Mt]=e,this[Ot]=t,this[Dt]=n,this[Lt]=s,this[Vt]=i}}function Gt(e){let t,n,s,i,r,a=e;for(;;){let{[Lt]:e,[Ot]:l}=a;if(null!==e){let{named:s,positional:i}=e;i.length>0&&(t=void 0===t?i:i.concat(t)),void 0===n&&(n=[]),n.unshift(s)}if(!It(l)){s=l,i=a[Dt],r=a[Vt];break}a=l}return{definition:s,owner:i,resolved:r,positional:t,named:n}}function jt(e,t,n,s,i=!1){return new Pt(e,t,n,s,i)}function zt(e){return"getDebugCustomRenderTree"in e}At.add(e.ChildScope,(e=>e.pushChildScope())),At.add(e.PopScope,(e=>e.popScope())),At.add(e.PushDynamicScope,(e=>e.pushDynamicScope())),At.add(e.PopDynamicScope,(e=>e.popDynamicScope())),At.add(e.Constant,((e,{op1:t})=>{e.stack.push(e[je].getValue(I(t)))})),At.add(e.ConstantReference,((e,{op1:t})=>{e.stack.push(y(e[je].getValue(I(t)),!1))})),At.add(e.Primitive,((e,{op1:t})=>{let n=e.stack;if(H(t)){let s=e[je].getValue(I(t));n.push(s)}else n.push(P(t))})),At.add(e.PrimitiveReference,(e=>{let t,n=e.stack,s=n.pop();t=void 0===s?g:null===s?w:!0===s?E:!1===s?C:v(s),n.push(t)})),At.add(e.Dup,((e,{op1:t,op2:n})=>{let s=e.fetchValue(t)-n;e.stack.dup(s)})),At.add(e.Pop,((e,{op1:t})=>{e.stack.pop(t)})),At.add(e.Load,((e,{op1:t})=>{e.load(t)})),At.add(e.Fetch,((e,{op1:t})=>{e.fetch(t)})),At.add(e.BindDynamicScope,((e,{op1:t})=>{let n=e[je].getArray(t);e.bindDynamicScope(n)})),At.add(e.Enter,((e,{op1:t})=>{e.enter(t)})),At.add(e.Exit,(e=>{e.exit()})),At.add(e.PushSymbolTable,((e,{op1:t})=>{e.stack.push(e[je].getValue(t))})),At.add(e.PushBlockScope,(e=>{e.stack.push(e.scope())})),At.add(e.CompileBlock,(e=>{let t=e.stack,n=t.pop();n?t.push(e.compile(n)):t.push(null)})),At.add(e.InvokeYield,(e=>{let{stack:t}=e,n=t.pop(),s=t.pop(),i=t.pop();V(null===i||i&&"object"==typeof i&&Array.isArray(i.parameters),`Expected top of stack to be Option<BlockSymbolTable>, was ${String(i)}`);let r=t.pop();if(null===i)return e.pushFrame(),void e.pushScope(s??e.scope());let a=M(s,"BUG: expected scope");{let e=i.parameters,t=e.length;if(t>0){a=a.child();for(let n=0;n<t;n++)a.bindSymbol(A(e[n]),r.at(n))}}e.pushFrame(),e.pushScope(a),e.call(n)})),At.add(e.JumpIf,((e,{op1:t})=>{let n=e.stack.pop(),s=Boolean(k(n));S(n)?!0===s&&e.goto(t):(!0===s&&e.goto(t),e.updateWith(new Ft(n)))})),At.add(e.JumpUnless,((e,{op1:t})=>{let n=e.stack.pop(),s=Boolean(k(n));S(n)?!1===s&&e.goto(t):(!1===s&&e.goto(t),e.updateWith(new Ft(n)))})),At.add(e.JumpEq,((e,{op1:t,op2:n})=>{e.stack.peek()===n&&e.goto(t)})),At.add(e.AssertSame,(e=>{let t=e.stack.peek();!1===S(t)&&e.updateWith(new Ft(t))})),At.add(e.ToBoolean,(e=>{let{stack:t}=e,n=t.pop();t.push(b((()=>le(k(n)))))}));class Ft{last;constructor(e){this.ref=e,this.last=k(e)}evaluate(e){let{last:t,ref:n}=this;t!==k(n)&&e.throw()}}class Wt{last;constructor(e,t){this.ref=e,this.filter=t,this.last=t(k(e))}evaluate(e){let{last:t,ref:n,filter:s}=this;t!==s(k(n))&&e.throw()}}class $t{tag=we;lastRevision=Ee;target;finalize(e,t){this.target=t,this.didModify(e)}evaluate(e){let{tag:t,target:n,lastRevision:s}=this;!e.alwaysRevalidate&&Ce(t,s)&&(xe(t),e.goto(M(n,"VM BUG: Target must be set before attempting to jump")))}didModify(e){this.tag=e,this.lastRevision=Ne(this.tag),xe(e)}}class Yt{constructor(e){this.debugLabel=e}evaluate(){ve(this.debugLabel)}}class Jt{constructor(e){this.target=e}evaluate(){let e=Se();this.target.didModify(e)}}At.add(e.Text,((e,{op1:t})=>{e.elements().appendText(e[je].getValue(t))})),At.add(e.Comment,((e,{op1:t})=>{e.elements().appendComment(e[je].getValue(t))})),At.add(e.OpenElement,((e,{op1:t})=>{e.elements().openElement(e[je].getValue(t))})),At.add(e.OpenDynamicElement,(e=>{let t=k(e.stack.pop());e.elements().openElement(t)})),At.add(e.PushRemoteElement,(e=>{let t=e.stack.pop(),n=e.stack.pop(),s=e.stack.pop(),i=k(t),r=k(n),a=k(s);S(t)||e.updateWith(new Ft(t)),void 0===r||S(n)||e.updateWith(new Ft(n));let l=e.elements().pushRemoteElement(i,a,r);if(l&&e.associateDestroyable(l),void 0!==e.env.debugRenderTree){let s=fn(void 0===r?{}:{insertBefore:n},[t]);e.env.debugRenderTree.create(l,{type:"keyword",name:"in-element",args:s,instance:null}),ne(l,(()=>{e.env.debugRenderTree?.willDestroy(l)}))}})),At.add(e.PopRemoteElement,(e=>{let t=e.elements().popRemoteElement();void 0!==e.env.debugRenderTree&&e.env.debugRenderTree.didRender(t,t)})),At.add(e.FlushElement,(e=>{let t=e.fetchValue(s),n=null;t&&(n=t.flush(e),e.loadValue(s,null)),e.elements().flushElement(n)})),At.add(e.CloseElement,(e=>{let t=e.elements().closeElement();null!==t&&t.forEach((t=>{e.env.scheduleInstallModifier(t);const n=t.manager.getDestroyable(t.state);null!==n&&e.associateDestroyable(n)}))})),At.add(e.Modifier,((e,{op1:t})=>{if(!1===e.env.isInteractive)return;let n=e.getOwner(),i=e.stack.pop(),r=e[je].getValue(t),{manager:a}=r,{constructing:l}=e.elements(),o=i.capture(),u=a.create(n,M(l,"BUG: ElementModifier could not find the element it applies to"),r.state,o),c={manager:a,state:u,definition:r};M(e.fetchValue(s),"BUG: ElementModifier could not find operations to append to").addModifier(e,c,o);let p=a.getTag(u);return null!==p?(xe(p),e.updateWith(new Kt(p,c))):void 0})),At.add(e.DynamicModifier,(e=>{if(!1===e.env.isInteractive)return;let{stack:t}=e,i=t.pop(),r=t.pop().capture(),{positional:a,named:l}=r,{constructing:o}=e.elements(),u=e.getOwner(),c=b((()=>{let e,t,s=k(i);if(!U(s))return;if(Ht(s,n.Modifier)){let{definition:n,owner:i,positional:o,named:u}=Gt(s);t=n,e=i,void 0!==o&&(r.positional=o.concat(a)),void 0!==u&&(r.named=Object.assign({},...u,l))}else t=s,e=u;let c=ce(t,!0);if(null===c)throw new Error("BUG: modifier manager expected");let p={resolvedName:null,manager:c,state:t},d=c.create(e,M(o,"BUG: ElementModifier could not find the element it applies to"),p.state,r);return{manager:c,state:d,definition:p}})),p=k(c),d=null;return void 0!==p&&(M(e.fetchValue(s),"BUG: ElementModifier could not find operations to append to").addModifier(e,p,r),d=p.manager.getTag(p.state),null!==d&&xe(d)),!S(i)||d?e.updateWith(new qt(d,p,c)):void 0}));class Kt{lastUpdated;constructor(e,t){this.tag=e,this.modifier=t,this.lastUpdated=Ne(e)}evaluate(e){let{modifier:t,tag:n,lastUpdated:s}=this;xe(n),Ce(n,s)||(e.env.scheduleUpdateModifier(t),this.lastUpdated=Ne(n))}}class qt{lastUpdated;constructor(e,t,n){this.tag=e,this.instance=t,this.instanceRef=n,this.lastUpdated=Ne(e??Te)}evaluate(e){let{tag:t,lastUpdated:n,instance:s,instanceRef:i}=this,r=k(i);if(r!==s){if(void 0!==s){let e=s.manager.getDestroyable(s.state);null!==e&&se(e)}if(void 0!==r){let{manager:n,state:s}=r,i=n.getDestroyable(s);null!==i&&ie(this,i),t=n.getTag(s),null!==t&&(this.lastUpdated=Ne(t)),this.tag=t,e.env.scheduleInstallModifier(r)}this.instance=r}else null===t||Ce(t,n)||(e.env.scheduleUpdateModifier(s),this.lastUpdated=Ne(t));null!==t&&xe(t)}}At.add(e.StaticAttr,((e,{op1:t,op2:n,op3:s})=>{let i=e[je].getValue(t),r=e[je].getValue(n),a=s?e[je].getValue(s):null;e.elements().setStaticAttribute(i,r,a)})),At.add(e.DynamicAttr,((e,{op1:t,op2:n,op3:s})=>{let i=e[je].getValue(t),r=e[je].getValue(n),a=e.stack.pop(),l=k(a),o=s?e[je].getValue(s):null,u=e.elements().setDynamicAttribute(i,l,r,o);S(a)||e.updateWith(new Xt(a,u,e.env))}));class Xt{updateRef;constructor(e,t,n){let s=!1;this.updateRef=b((()=>{let i=k(e);!0===s?t.update(i,n):s=!0})),k(this.updateRef)}evaluate(){k(this.updateRef)}}At.add(e.PushComponentDefinition,((e,{op1:t})=>{let n=e[je].getValue(t);V(!!n,`Missing component for ${t}`);let{manager:s,capabilities:i}=n,r={definition:n,manager:s,capabilities:i,state:null,handle:null,table:null,lookup:null};e.stack.push(r)})),At.add(e.ResolveDynamicComponent,((e,{op1:t})=>{let n,s=e.stack,r=k(s.pop()),a=e[je],l=e.getOwner();if(a.getValue(t),e.loadValue(i,null),"string"==typeof r){let t=function(e,t,n,s){let i=e.lookupComponent(n,M(s,"BUG: expected owner when looking up component"));return t.resolvedComponent(i,n)}(e.runtime.resolver,a,r,l);n=M(t,`Could not find a component named "${r}"`)}else n=It(r)?r:a.component(r,l);s.push(n)})),At.add(e.ResolveCurriedComponent,(e=>{let t,n=e.stack,s=n.pop(),i=k(s),r=e[je];t=It(i)?i:r.component(i,e.getOwner(),!0),n.push(t)})),At.add(e.PushDynamicComponentInstance,(e=>{let t,n,{stack:s}=e,i=s.pop();It(i)?n=t=null:(n=i.manager,t=i.capabilities),s.push({definition:i,capabilities:t,manager:n,state:null,handle:null,table:null})})),At.add(e.PushArgs,((e,{op1:t,op2:n,op3:s})=>{let i=e.stack,r=e[je].getArray(t),a=s>>4,l=8&s,o=7&s?e[je].getArray(n):G;e[ze].setup(i,r,o,a,!!l),i.push(e[ze])})),At.add(e.PushEmptyArgs,(e=>{let{stack:t}=e;t.push(e[ze].empty(t))})),At.add(e.CaptureArgs,(e=>{let t=e.stack,n=t.pop().capture();t.push(n)})),At.add(e.PrepareArgs,((e,{op1:t})=>{let s=e.stack,a=e.fetchValue(t),l=s.pop(),{definition:o}=a;if(Ht(o,n.Component)){V(!o.manager,"If the component definition was curried, we don't yet have a manager");let t=e[je],{definition:n,owner:s,resolved:r,positional:u,named:c}=Gt(o);if(!0===r)o=n;else if("string"==typeof n){let i=e.runtime.resolver.lookupComponent(n,s);o=t.resolvedComponent(M(i,"BUG: expected resolved component"),n)}else o=t.component(n,s);void 0!==c&&l.named.merge(R({},...c)),void 0!==u&&(l.realloc(u.length),l.positional.prepend(u));let{manager:p}=o;V(null===a.manager,"component instance manager should not be populated yet"),V(null===a.capabilities,"component instance manager should not be populated yet"),a.definition=o,a.manager=p,a.capabilities=o.capabilities,e.loadValue(i,s)}let{manager:u,state:c}=o,p=a.capabilities;if(!pe(u,p,r.prepareArgs))return void s.push(l);let d=l.blocks.values,h=l.blocks.names,m=u.prepareArgs(c,l);if(m){l.clear();for(let e=0;e<d.length;e++)s.push(d[e]);let{positional:e,named:t}=m,n=e.length;for(let t=0;t<n;t++)s.push(e[t]);let i=Object.keys(t);for(let e=0;e<i.length;e++)s.push(t[A(i[e])]);l.setup(s,i,h,n,!1)}s.push(l)})),At.add(e.CreateComponent,((e,{op1:t,op2:n})=>{let s=e.fetchValue(n),{definition:i,manager:a,capabilities:l}=s;if(!pe(a,l,r.createInstance))return;let o=null;pe(a,l,r.dynamicScope)&&(o=e.dynamicScope());let u=1&t,c=null;pe(a,l,r.createArgs)&&(c=e.stack.peek());let p=null;pe(a,l,r.createCaller)&&(p=e.getSelf());let d=a.create(e.getOwner(),i.state,c,e.env,o,p,!!u);s.state=d,pe(a,l,r.updateHook)&&e.updateWith(new nn(d,a,o))})),At.add(e.RegisterComponentDestructor,((e,{op1:t})=>{let{manager:n,state:s,capabilities:i}=e.fetchValue(t),r=n.getDestroyable(s);r&&e.associateDestroyable(r)})),At.add(e.BeginComponentTransaction,((e,{op1:t})=>{e.beginCacheGroup(void 0),e.elements().pushSimpleBlock()})),At.add(e.PutComponentOperations,(e=>{e.loadValue(s,new Qt)})),At.add(e.ComponentAttr,((e,{op1:t,op2:n,op3:i})=>{let r=e[je].getValue(t),a=e[je].getValue(n),l=e.stack.pop(),o=i?e[je].getValue(i):null;e.fetchValue(s).setAttribute(r,l,a,o)})),At.add(e.StaticComponentAttr,((e,{op1:t,op2:n,op3:i})=>{let r=e[je].getValue(t),a=e[je].getValue(n),l=i?e[je].getValue(i):null;e.fetchValue(s).setStaticAttribute(r,a,l)}));class Qt{attributes=j();classes=[];modifiers=[];setAttribute(e,t,n,s){let i={value:t,namespace:s,trusting:n};"class"===e&&this.classes.push(t),this.attributes[e]=i}setStaticAttribute(e,t,n){let s={value:t,namespace:n};"class"===e&&this.classes.push(t),this.attributes[e]=s}addModifier(e,t,n){if(this.modifiers.push(t),void 0!==e.env.debugRenderTree){const{manager:s,definition:i,state:r}=t;if(null===r||"object"!=typeof r&&"function"!=typeof r)return;let{element:a,constructing:l}=e.elements(),o=s.getDebugName(i.state),u=s.getDebugInstance(r);V(l,"Expected a constructing element in addModifier");let c=new We(a,l,l);e.env.debugRenderTree.create(r,{type:"modifier",name:o,args:n,instance:u}),e.env.debugRenderTree.didRender(r,c),e.associateDestroyable(r),e.updateWith(new rn(r)),e.updateWith(new an(r,c)),ne(r,(()=>{e.env.debugRenderTree?.willDestroy(r)}))}}flush(e){let t,n=this.attributes;for(let s in this.attributes){if("type"===s){t=n[s];continue}let i=A(this.attributes[s]);"class"===s?en(e,"class",Zt(this.classes),i.namespace,i.trusting):en(e,s,i.value,i.namespace,i.trusting)}return void 0!==t&&en(e,"type",t.value,t.namespace,t.trusting),this.modifiers}}function Zt(e){return 0===e.length?"":1===e.length?A(e[0]):function(e){return e.every((e=>"string"==typeof e))}(e)?e.join(" "):(t=e,b((()=>{let e=[];for(const n of t){let t=Je("string"==typeof n?n:k(n));t&&e.push(t)}return 0===e.length?null:e.join(" ")})));var t}function en(e,t,n,s,i=!1){if("string"==typeof n)e.elements().setStaticAttribute(t,n,s);else{let r=e.elements().setDynamicAttribute(t,k(n),i,s);S(n)||e.updateWith(new Xt(n,r,e.env))}}function tn(e,t,n,s,i){let r=n.table.symbols.indexOf(e),a=s.get(t);-1!==r&&i.scope().bindBlock(r+1,a),n.lookup&&(n.lookup[e]=a)}At.add(e.DidCreateElement,((e,{op1:t})=>{let{definition:n,state:i}=e.fetchValue(t),{manager:r}=n,a=e.fetchValue(s);r.didCreateElement(i,M(e.elements().constructing,"Expected a constructing element in DidCreateOpcode"),a)})),At.add(e.GetComponentSelf,((e,{op1:t,op2:n})=>{let s=e.fetchValue(t),{definition:i,state:a}=s,{manager:l}=i,o=l.getSelf(a);if(void 0!==e.env.debugRenderTree){let s,i,l=e.fetchValue(t),{definition:u,manager:c}=l;if(e.stack.peek()===e[ze])s=e[ze].capture();else{let t=e[je].getArray(n);e[ze].setup(e.stack,t,[],0,!0),s=e[ze].capture()}let p=u.compilable;if(null===p?(V(pe(c,l.capabilities,r.dynamicLayout),"BUG: No template was found for this component, and the component did not have the dynamic layout capability"),p=c.getDynamicLayout(a,e.runtime.resolver),i=null!==p?p.moduleName:"__default__.hbs"):i=p.moduleName,e.associateDestroyable(l),zt(c))c.getDebugCustomRenderTree(l.definition.state,l.state,s,i).forEach((t=>{let{bucket:n}=t;e.env.debugRenderTree.create(n,t),ne(l,(()=>{e.env.debugRenderTree?.willDestroy(n)})),e.updateWith(new rn(n))}));else{let t=u.resolvedName??c.getDebugName(u.state);e.env.debugRenderTree.create(l,{type:"component",name:t,args:s,template:i,instance:k(o)}),ne(l,(()=>{e.env.debugRenderTree?.willDestroy(l)})),e.updateWith(new rn(l))}}e.stack.push(o)})),At.add(e.GetComponentTagName,((e,{op1:t})=>{let{definition:n,state:s}=e.fetchValue(t),{manager:i}=n,r=i.getTagName(s);e.stack.push(r)})),At.add(e.GetComponentLayout,((e,{op1:t})=>{let n=e.fetchValue(t),{manager:s,definition:i}=n,{stack:a}=e,{compilable:l}=i;if(null===l){let{capabilities:t}=n;V(pe(s,t,r.dynamicLayout),"BUG: No template was found for this component, and the component did not have the dynamic layout capability"),l=s.getDynamicLayout(n.state,e.runtime.resolver),null===l&&(l=pe(s,t,r.wrapped)?z(e[je].defaultTemplate).asWrappedLayout():z(e[je].defaultTemplate).asLayout())}let o=l.compile(e.context);a.push(l.symbolTable),a.push(o)})),At.add(e.Main,((e,{op1:t})=>{let n=e.stack.pop(),s=e.stack.pop(),{manager:i,capabilities:r}=n,a={definition:n,manager:i,capabilities:r,state:null,handle:s.handle,table:s.symbolTable,lookup:null};e.loadValue(t,a)})),At.add(e.PopulateLayout,((e,{op1:t})=>{let{stack:n}=e,s=n.pop(),i=n.pop(),r=e.fetchValue(t);r.handle=s,r.table=i})),At.add(e.VirtualRootScope,((e,{op1:t})=>{let n,{table:s,manager:a,capabilities:l,state:o}=e.fetchValue(t);pe(a,l,r.hasSubOwner)?(n=a.getOwner(o),e.loadValue(i,null)):(n=e.fetchValue(i),null===n?n=e.getOwner():e.loadValue(i,null)),e.pushRootScope(s.symbols.length+1,n)})),At.add(e.SetupForEval,((e,{op1:t})=>{let n=e.fetchValue(t);if(n.table.hasEval){let t=n.lookup=j();e.scope().bindEvalScope(t)}})),At.add(e.SetNamedVariables,((e,{op1:t})=>{let n=e.fetchValue(t),s=e.scope(),i=e.stack.peek(),r=i.named.atNames;for(let e=r.length-1;e>=0;e--){let t=A(r[e]),a=n.table.symbols.indexOf(t),l=i.named.get(t,!0);-1!==a&&s.bindSymbol(a+1,l),n.lookup&&(n.lookup[t]=l)}})),At.add(e.SetBlocks,((e,{op1:t})=>{let n=e.fetchValue(t),{blocks:s}=e.stack.peek();for(const[t]of F(s.names))tn(A(s.symbolNames[t]),A(s.names[t]),n,s,e)})),At.add(e.InvokeComponentLayout,((e,{op1:t})=>{let n=e.fetchValue(t);e.call(n.handle)})),At.add(e.DidRenderLayout,((e,{op1:t})=>{let n=e.fetchValue(t),{manager:s,state:i,capabilities:a}=n,l=e.elements().popBlock();void 0!==e.env.debugRenderTree&&(zt(s)?s.getDebugCustomRenderTree(n.definition.state,i,xn).reverse().forEach((t=>{let{bucket:n}=t;e.env.debugRenderTree.didRender(n,l),e.updateWith(new an(n,l))})):(e.env.debugRenderTree.didRender(n,l),e.updateWith(new an(n,l)))),pe(s,a,r.createInstance)&&(s.didRenderLayout(i,l),e.env.didCreate(n),e.updateWith(new sn(n,l)))})),At.add(e.CommitComponentTransaction,(e=>{e.commitCacheGroup()}));class nn{constructor(e,t,n){this.component=e,this.manager=t,this.dynamicScope=n}evaluate(e){let{component:t,manager:n,dynamicScope:s}=this;n.update(t,s)}}class sn{constructor(e,t){this.component=e,this.bounds=t}evaluate(e){let{component:t,bounds:n}=this,{manager:s,state:i}=t;s.didUpdateLayout(i,n),e.env.didUpdate(t)}}class rn{constructor(e){this.bucket=e}evaluate(e){e.env.debugRenderTree?.update(this.bucket)}}class an{constructor(e,t){this.bucket=e,this.bounds=t}evaluate(e){e.env.debugRenderTree?.didRender(this.bucket,this.bounds)}}class ln{stack=null;positional=new un;named=new cn;blocks=new hn;empty(e){let t=e[Pe][a]+1;return this.named.empty(e,t),this.positional.empty(e,t),this.blocks.empty(e,t),this}setup(e,t,n,s,i){this.stack=e;let r=this.named,l=t.length,o=e[Pe][a]-l+1;r.setup(e,o,l,t,i);let u=o-s;this.positional.setup(e,u,s);let c=this.blocks,p=n.length,d=u-3*p;c.setup(e,d,p,n)}get base(){return this.blocks.base}get length(){return this.positional.length+this.named.length+3*this.blocks.length}at(e){return this.positional.at(e)}realloc(e){let{stack:t}=this;if(e>0&&null!==t){let{positional:n,named:s}=this,i=n.base+e;for(let e=n.length+s.length-1;e>=0;e--)t.copy(e+n.base,e+i);n.base+=e,s.base+=e,t[Pe][a]+=e}}capture(){let e=0===this.positional.length?Cn:this.positional.capture();return{named:0===this.named.length?En:this.named.capture(),positional:e}}clear(){let{stack:e,length:t}=this;t>0&&null!==e&&e.pop(t)}}const on=W();class un{base=0;length=0;stack=null;_references=null;empty(e,t){this.stack=e,this.base=t,this.length=0,this._references=on}setup(e,t,n){this.stack=e,this.base=t,this.length=n,this._references=0===n?on:null}at(e){let{base:t,length:n,stack:s}=this;return e<0||e>=n?g:s.get(e,t)}capture(){return this.references}prepend(e){let t=e.length;if(t>0){let{base:n,length:s,stack:i}=this;this.base=n-=t,this.length=s+t;for(let s=0;s<t;s++)i.set(e[s],s,n);this._references=null}}get references(){let e=this._references;if(!e){let{stack:t,base:n,length:s}=this;e=this._references=t.slice(n,n+s)}return e}}class cn{base=0;length=0;_references=null;_names=G;_atNames=G;empty(e,t){this.stack=e,this.base=t,this.length=0,this._references=on,this._names=G,this._atNames=G}setup(e,t,n,s,i){this.stack=e,this.base=t,this.length=n,0===n?(this._references=on,this._names=G,this._atNames=G):(this._references=null,i?(this._names=null,this._atNames=s):(this._names=s,this._atNames=null))}get names(){let e=this._names;return e||(e=this._names=this._atNames.map(this.toSyntheticName)),e}get atNames(){let e=this._atNames;return e||(e=this._atNames=this._names.map(this.toAtName)),e}has(e){return-1!==this.names.indexOf(e)}get(e,t=!1){let{base:n,stack:s}=this,i=(t?this.atNames:this.names).indexOf(e);return-1===i?g:s.get(i,n)}capture(){let{names:e,references:t}=this,n=j();for(const[s,i]of F(e))n[i]=A(t[s]);return n}merge(e){let t=Object.keys(e);if(t.length>0){let{names:n,length:s,stack:i}=this,r=n.slice();for(const n of t)-1===r.indexOf(n)&&(s=r.push(n),i.push(e[n]));this.length=s,this._references=null,this._names=r,this._atNames=null}}get references(){let e=this._references;if(!e){let{base:t,length:n,stack:s}=this;e=this._references=s.slice(t,t+n)}return e}toSyntheticName(e){return e.slice(1)}toAtName(e){return`@${e}`}}function pn(e){return`&${e}`}const dn=W();class hn{internalValues=null;_symbolNames=null;internalTag=null;names=G;length=0;base=0;empty(e,t){this.stack=e,this.names=G,this.base=t,this.length=0,this._symbolNames=null,this.internalTag=we,this.internalValues=dn}setup(e,t,n,s){this.stack=e,this.names=s,this.base=t,this.length=n,this._symbolNames=null,0===n?(this.internalTag=we,this.internalValues=dn):(this.internalTag=null,this.internalValues=null)}get values(){let e=this.internalValues;if(!e){let{base:t,length:n,stack:s}=this;e=this.internalValues=s.slice(t,t+3*n)}return e}has(e){return-1!==this.names.indexOf(e)}get(e){let t=this.names.indexOf(e);if(-1===t)return null;let{base:n,stack:s}=this,i=s.get(3*t,n),r=s.get(3*t+1,n),a=s.get(3*t+2,n);return null===a?null:[a,r,i]}capture(){return new mn(this.names,this.values)}get symbolNames(){let e=this._symbolNames;return null===e&&(e=this._symbolNames=this.names.map(pn)),e}}class mn{length;constructor(e,t){this.names=e,this.values=t,this.length=e.length}has(e){return-1!==this.names.indexOf(e)}get(e){let t=this.names.indexOf(e);return-1===t?null:[this.values[3*t+2],this.values[3*t+1],this.values[3*t]]}}function fn(e,t){return{named:e,positional:t}}function gn(e){let t=j();for(const[n,s]of Object.entries(e))t[n]=k(s);return t}function bn(e){return e.map(k)}function kn(e){return{named:gn(e.named),positional:bn(e.positional)}}const yn=Symbol("ARGUMENT_ERROR");function vn(e){return null!==e&&"object"==typeof e&&e[yn]}function Sn(e){return{[yn]:!0,error:e}}function wn(e){return{named:function(e){let t=j();for(const[n,s]of Object.entries(e))try{t[n]=k(s)}catch(e){t[n]=Sn(e)}return t}(e.named),positional:(t=e.positional,t.map((e=>{try{return k(e)}catch(e){return Sn(e)}})))};var t}const En=Object.freeze(Object.create(null)),Cn=on,xn=fn(En,Cn);function Nn(e){return"string"==typeof e?e:"function"!=typeof e.toString?"":String(e)}function Tn(e,t){let n,s=de(e,!0);return null===s?n=null:(n="function"==typeof s?s:s.getHelper(e),V(s,"BUG: expected manager or helper")),n}function _n(e){return V(Array.isArray(e)||e===g,"a reference other than UNDEFINED_REFERENCE is illegal here"),e===g}At.add(e.Curry,((e,{op1:t,op2:s})=>{let i=e.stack,r=i.pop(),a=i.pop(),o=e.getOwner();e.runtime.resolver,e.loadValue(l,function(e,t,s,i,r,a){let l,o;return b((()=>{let r=k(t);return r===l||(o=Ht(r,e)?i?jt(e,r,s,i):i:e===n.Component&&"string"==typeof r&&r||U(r)?jt(e,r,s,i):null,l=r),o}))}(t,r,o,a))})),At.add(e.DynamicHelper,(e=>{let t,s=e.stack,i=s.pop(),r=s.pop().capture(),a=e.getOwner(),o=b((()=>{void 0!==t&&se(t);let e=k(i);if(Ht(e,n.Helper)){let{definition:n,owner:s,positional:i,named:a}=Gt(e),l=Tn(n);void 0!==a&&(r.named=R({},...a,r.named)),void 0!==i&&(r.positional=i.concat(r.positional)),t=l(r,s),ie(o,t)}else if(U(e)){let n=Tn(e);t=n(r,a),re(t)&&ie(o,t)}else t=g})),u=b((()=>(k(o),k(t))));e.associateDestroyable(o),e.loadValue(l,u)})),At.add(e.Helper,((e,{op1:t})=>{let n=e.stack,s=e[je].getValue(t)(n.pop().capture(),e.getOwner(),e.dynamicScope());re(s)&&e.associateDestroyable(s),e.loadValue(l,s)})),At.add(e.GetVariable,((e,{op1:t})=>{let n=e.referenceForSymbol(t);e.stack.push(n)})),At.add(e.SetVariable,((e,{op1:t})=>{let n=e.stack.pop();e.scope().bindSymbol(t,n)})),At.add(e.SetBlock,((e,{op1:t})=>{let n=e.stack.pop(),s=e.stack.pop(),i=e.stack.pop();e.scope().bindBlock(t,[n,s,i])})),At.add(e.ResolveMaybeLocal,((e,{op1:t})=>{let n=e[je].getValue(t),s=e.scope().getPartialMap()[n];void 0===s&&(s=x(e.getSelf(),n)),e.stack.push(s)})),At.add(e.RootScope,((e,{op1:t})=>{e.pushRootScope(t,e.getOwner())})),At.add(e.GetProperty,((e,{op1:t})=>{let n=e[je].getValue(t),s=e.stack.pop();e.stack.push(x(s,n))})),At.add(e.GetBlock,((e,{op1:t})=>{let{stack:n}=e,s=e.scope().getBlock(t);n.push(s)})),At.add(e.SpreadBlock,(e=>{let{stack:t}=e,n=t.pop();if(n&&!_n(n)){let[e,s,i]=n;t.push(i),t.push(s),t.push(e)}else t.push(null),t.push(null),t.push(null)})),At.add(e.HasBlock,(e=>{let{stack:t}=e,n=t.pop();n&&!_n(n)?t.push(E):t.push(C)})),At.add(e.HasBlockParams,(e=>{e.stack.pop(),e.stack.pop();let t=e.stack.pop(),n=t&&t.parameters.length;e.stack.push(n?E:C)})),At.add(e.Concat,((e,{op1:t})=>{let n=new Array(t);for(let s=t;s>0;s--)n[s-1]=e.stack.pop();var s;e.stack.push((s=n,b((()=>{const e=[];for(const t of s){const n=k(t);null!=n&&e.push(Nn(n))}return e.length>0?e.join(""):null}))))})),At.add(e.IfInline,(e=>{let t=e.stack.pop(),n=e.stack.pop(),s=e.stack.pop();e.stack.push(b((()=>!0===le(k(t))?k(n):k(s))))})),At.add(e.Not,(e=>{let t=e.stack.pop();e.stack.push(b((()=>!le(k(t)))))})),At.add(e.GetDynamicVar,(e=>{let t=e.dynamicScope(),n=e.stack,s=n.pop();n.push(b((()=>{let e=String(k(s));return k(t.get(e))})))})),At.add(e.Log,(e=>{let{positional:t}=e.stack.pop().capture();e.loadValue(l,b((()=>{console.log(...bn(t))})))}));class Bn{constructor(e,t,n){this.node=e,this.reference=t,this.lastValue=n}evaluate(){let e,t=k(this.reference),{lastValue:n}=this;t!==n&&(e=Ke(t)?"":Qe(t)?t:String(t),e!==n)&&(this.node.nodeValue=this.lastValue=e)}}function Rn(e){return function(e){return Qe(e)||Ke(e)||"boolean"==typeof e||"number"==typeof e}(e)?o.String:Ht(e,u.Component)||he(e)?o.Component:Ht(e,u.Helper)||me(e)?o.Helper:qe(e)?o.SafeString:function(e){return Xe(e)&&11===e.nodeType}(e)?o.Fragment:Xe(e)?o.Node:o.String}function An(e){return U(e)?Ht(e,u.Component)||he(e)?o.Component:o.Helper:o.String}function Mn(e,t){console.info("Use `context`, and `get(<path>)` to debug this template."),t("this")}At.add(e.ContentType,(e=>{let t=e.stack.peek();e.stack.push(Rn(k(t))),S(t)||e.updateWith(new Wt(t,Rn))})),At.add(e.DynamicContentType,(e=>{let t=e.stack.peek();e.stack.push(An(k(t))),S(t)||e.updateWith(new Wt(t,An))})),At.add(e.AppendHTML,(e=>{let t=e.stack.pop(),n=k(t),s=Ke(n)?"":String(n);e.elements().appendDynamicHTML(s)})),At.add(e.AppendSafeHTML,(e=>{let t=e.stack.pop(),n=k(t).toHTML(),s=Ke(n)?"":n;e.elements().appendDynamicHTML(s)})),At.add(e.AppendText,(e=>{let t=e.stack.pop(),n=k(t),s=Ke(n)?"":String(n),i=e.elements().appendDynamicText(s);S(t)||e.updateWith(new Bn(i,t,s))})),At.add(e.AppendDocumentFragment,(e=>{let t=e.stack.pop(),n=k(t);e.elements().appendDynamicFragment(n)})),At.add(e.AppendNode,(e=>{let t=e.stack.pop(),n=k(t);e.elements().appendDynamicNode(n)}));let On=Mn;function Dn(e){On=e}function Ln(){On=Mn}class Vn{locals=j();constructor(e,t,n){this.scope=e;for(const s of n){let n=A(t[s-1]),i=e.getSymbol(s);this.locals[n]=i}}get(e){let t,{scope:n,locals:s}=this,i=e.split("."),[r,...a]=e.split("."),l=n.getEvalScope();return"this"===r?t=n.getSelf():s[r]?t=A(s[r]):0===r.indexOf("@")&&l[r]?t=l[r]:(t=this.scope.getSelf(),a=i),a.reduce(((e,t)=>x(e,t)),t)}}At.add(e.Debugger,((e,{op1:t,op2:n})=>{let s=e[je].getArray(t),i=e[je].getArray(I(n)),r=new Vn(e.scope(),s,i);On(k(e.getSelf()),(e=>k(r.get(e))))})),At.add(e.EnterList,((e,{op1:t,op2:n})=>{let s=e.stack,i=s.pop(),r=s.pop(),a=k(r),l=null===a?"@identity":String(a),o=N(i,l),u=k(o);e.updateWith(new Wt(o,(e=>e.isEmpty()))),!0===u.isEmpty()?e.goto(n+1):(e.enterList(o,t),e.stack.push(u))})),At.add(e.ExitList,(e=>{e.exitList()})),At.add(e.Iterate,((e,{op1:t})=>{let n=e.stack.peek().next();null!==n?e.registerItem(e.enterItem(n)):e.goto(t)}));const Un={dynamicLayout:!1,dynamicTag:!1,prepareArgs:!1,createArgs:!1,attributeHook:!1,elementHook:!1,createCaller:!1,dynamicScope:!1,updateHook:!1,createInstance:!1,wrapped:!1,willDestroy:!1,hasSubOwner:!1};class In{getCapabilities(){return Un}getDebugName({name:e}){return e}getSelf(){return w}getDestroyable(){return null}}const Hn=new In;class Pn{constructor(e="@glimmer/component/template-only",t="(unknown template-only component)"){this.moduleName=e,this.name=t}toString(){return this.moduleName}}function Gn(e,t){return new Pn(e,t)}fe(Hn,Pn.prototype);const jn={foreignObject:1,desc:1,title:1},zn=Object.create(null);class Fn{constructor(e){this.document=e,this.setupUselessElement()}setupUselessElement(){this.uselessElement=this.document.createElement("div")}createElement(e,t){let n,s;if(t?(n=t.namespaceURI===O||"svg"===e,s=!!jn[t.tagName]):(n="svg"===e,s=!1),n&&!s){if(zn[e])throw new Error(`Cannot create a ${e} inside an SVG context`);return this.document.createElementNS(O,e)}return this.document.createElement(e)}insertBefore(e,t,n){e.insertBefore(t,n)}insertHTMLBefore(e,t,n){if(""===n){const n=this.createComment("");return e.insertBefore(n,t),new We(e,n,n)}const s=t?t.previousSibling:e.lastChild;let i;if(null===t)e.insertAdjacentHTML($,n),i=M(e.lastChild,"bug in insertAdjacentHTML?");else if(t instanceof HTMLElement)t.insertAdjacentHTML("beforebegin",n),i=M(t.previousSibling,"bug in insertAdjacentHTML?");else{const{uselessElement:s}=this;e.insertBefore(s,t),s.insertAdjacentHTML(Y,n),i=M(s.previousSibling,"bug in insertAdjacentHTML?"),e.removeChild(s)}const r=M(s?s.nextSibling:e.firstChild,"bug in insertAdjacentHTML?");return new We(e,r,i)}createTextNode(e){return this.document.createTextNode(e)}createComment(e){return this.document.createComment(e)}}function Wn(e,t,n){if(!e)return t;if(!function(e,t){const n=e.createElementNS(t,"svg");try{n.insertAdjacentHTML($,"<circle></circle>")}catch(e){}finally{return 1!==n.childNodes.length||D(A(n.firstChild),"SVG").namespaceURI!==O}}(e,n))return t;const s=e.createElement("div");return class extends t{insertHTMLBefore(e,t,i){return""===i||e.namespaceURI!==n?super.insertHTMLBefore(e,t,i):function(e,t,n,s){let i;if(V(""!==n,"html cannot be empty"),"FOREIGNOBJECT"===e.tagName.toUpperCase()){const e="<svg><foreignObject>"+n+"</foreignObject></svg>";J(t),t.insertAdjacentHTML(K,e),i=t.firstChild.firstChild}else{const e="<svg>"+n+"</svg>";J(t),t.insertAdjacentHTML(K,e),i=t.firstChild}return function(e,t,n){const s=M(e.firstChild,"source is empty");let i=s,r=s;for(;r;){const e=r.nextSibling;t.insertBefore(r,n),i=r,r=e}return new We(t,s,i)}(i,e,s)}(e,s,i,t)}}}function $n(e,t){return e&&function(e){const t=e.createElement("div");return t.appendChild(e.createTextNode("first")),t.insertAdjacentHTML($,"second"),2!==t.childNodes.length}(e)?class extends t{uselessComment;constructor(e){super(e),this.uselessComment=e.createComment("")}insertHTMLBefore(e,t,n){if(""===n)return super.insertHTMLBefore(e,t,n);let s=!1;const i=t?t.previousSibling:e.lastChild;i&&i instanceof Text&&(s=!0,e.insertBefore(this.uselessComment,t));const r=super.insertHTMLBefore(e,t,n);return s&&e.removeChild(this.uselessComment),r}}:t}const Yn="undefined"==typeof document?null:q(document);let Jn=class extends Fn{createElementNS(e,t){return this.document.createElementNS(e,t)}setAttribute(e,t,n,s=null){s?e.setAttributeNS(s,t,n):e.setAttribute(t,n)}};Jn=$n(Yn,Jn),Jn=Wn(Yn,Jn,O);const Kn=Jn;["b","big","blockquote","body","br","center","code","dd","div","dl","dt","em","embed","h1","h2","h3","h4","h5","h6","head","hr","i","img","li","listing","main","meta","nobr","ol","p","pre","ruby","s","small","span","strong","strike","sub","sup","table","tt","u","ul","var"].forEach((e=>zn[e]=1));const qn=/[\t\n\v\f\r \xA0\u{1680}\u{180e}\u{2000}-\u{200a}\u{2028}\u{2029}\u{202f}\u{205f}\u{3000}\u{feff}]/u,Xn="undefined"==typeof document?null:q(document);function Qn(e){return qn.test(e)}class Zn extends Fn{namespace;constructor(e){super(e),this.document=e,this.namespace=null}setAttribute(e,t,n){e.setAttribute(t,n)}removeAttribute(e,t){e.removeAttribute(t)}insertAfter(e,t,n){this.insertBefore(e,t,n.nextSibling)}}let es=Zn;es=$n(Xn,es),es=Wn(Xn,es,O);const ts=es;let ns=0;class ss{id=ns++;value;constructor(e){this.value=e}get(){return this.value}release(){this.value=null}toString(){let e=`Ref ${this.id}`;if(null===this.value)return`${e} (released)`;try{return`${e}: ${this.value}`}catch{return e}}}class is{stack=new L;refs=new WeakMap;roots=new Set;nodes=new WeakMap;begin(){this.reset()}create(e,t){let n=R({},t,{bounds:null,refs:new Set});this.nodes.set(e,n),this.appendChild(n,e),this.enter(e)}update(e){this.enter(e)}didRender(e,t){this.nodeFor(e).bounds=t,this.exit()}willDestroy(e){M(this.refs.get(e),"BUG: missing ref").release()}commit(){this.reset()}capture(){return this.captureRefs(this.roots)}reset(){if(0!==this.stack.size){let e=M(this.stack.toArray()[0],"expected root state when resetting render tree"),t=this.refs.get(e);for(void 0!==t&&this.roots.delete(t);!this.stack.isEmpty();)this.stack.pop()}}enter(e){this.stack.push(e)}exit(){this.stack.pop()}nodeFor(e){return M(this.nodes.get(e),"BUG: missing node")}appendChild(e,t){let n=this.stack.current,s=new ss(t);if(this.refs.set(t,s),n){let t=this.nodeFor(n);t.refs.add(s),e.parent=t}else this.roots.add(s)}captureRefs(e){let t=[];return e.forEach((n=>{let s=n.get();s?t.push(this.captureNode(`render-node:${n.id}`,s)):e.delete(n)})),t}captureNode(e,t){let n=this.nodeFor(t),{type:s,name:i,args:r,instance:a,refs:l}=n,o=this.captureTemplate(n),u=this.captureBounds(n),c=this.captureRefs(l);return{id:e,type:s,name:i,args:wn(r),instance:a,template:o,bounds:u,children:c}}captureTemplate({template:e}){return e||null}captureBounds(e){let t=M(e.bounds,"BUG: missing bounds");return{parentElement:t.parentElement(),firstNode:t.firstNode(),lastNode:t.lastNode()}}}const rs=Symbol("TRANSACTION");class as{scheduledInstallModifiers=[];scheduledUpdateModifiers=[];createdComponents=[];updatedComponents=[];didCreate(e){this.createdComponents.push(e)}didUpdate(e){this.updatedComponents.push(e)}scheduleInstallModifier(e){this.scheduledInstallModifiers.push(e)}scheduleUpdateModifier(e){this.scheduledUpdateModifiers.push(e)}commit(){let{createdComponents:e,updatedComponents:t}=this;for(const{manager:t,state:n}of e)t.didCreate(n);for(const{manager:e,state:n}of t)e.didUpdate(n);let{scheduledInstallModifiers:n,scheduledUpdateModifiers:s}=this;for(const{manager:e,state:t,definition:s}of n){let n=e.getTag(t);if(null!==n){let s=_e((()=>e.install(t)),!1);Be(n,s)}else e.install(t)}for(const{manager:e,state:t,definition:n}of s){let n=e.getTag(t);if(null!==n){let s=_e((()=>e.update(t)),!1);Be(n,s)}else e.update(t)}}}class ls{[rs]=null;updateOperations;isInteractive;isArgumentCaptureError;debugRenderTree;constructor(e,t){this.delegate=t,this.isInteractive=t.isInteractive,this.debugRenderTree=this.delegate.enableDebugTooling?new is:void 0,this.isArgumentCaptureError=this.delegate.enableDebugTooling?vn:void 0,e.appendOperations?(this.appendOperations=e.appendOperations,this.updateOperations=e.updateOperations):e.document&&(this.appendOperations=new Kn(e.document),this.updateOperations=new Zn(e.document))}getAppendOperations(){return this.appendOperations}getDOM(){return M(this.updateOperations,"Attempted to get DOM updateOperations, but they were not provided by the environment. You may be attempting to rerender in an environment which does not support rerendering, such as SSR.")}begin(){V(!this[rs],"A glimmer transaction was begun, but one already exists. You may have a nested transaction, possibly caused by an earlier runtime exception while rendering. Please check your console for the stack trace of any prior exceptions."),this.debugRenderTree?.begin(),this[rs]=new as}get transaction(){return M(this[rs],"must be in a transaction")}didCreate(e){this.transaction.didCreate(e)}didUpdate(e){this.transaction.didUpdate(e)}scheduleInstallModifier(e){this.isInteractive&&this.transaction.scheduleInstallModifier(e)}scheduleUpdateModifier(e){this.isInteractive&&this.transaction.scheduleUpdateModifier(e)}commit(){let e=this.transaction;this[rs]=null,e.commit(),this.debugRenderTree?.commit(),this.delegate.onTransactionCommit()}}function os(e,t,n,s){return{env:new ls(e,t),program:new Oe(n.constants,n.heap),resolver:s}}function us(e,t){if(e[rs])t();else{e.begin();try{t()}finally{e.commit()}}}function cs(e){return ge(e,{})}const ps=cs((({positional:e})=>b((()=>bn(e)),null,"array"))),ds=e=>(e=>null==e||"function"!=typeof e.toString)(e)?"":String(e),hs=cs((({positional:e})=>b((()=>bn(e).map(ds).join("")),null,"concat"))),ms=X("`fn` helper"),fs=cs((({positional:e})=>{let t=e[0];return b((()=>(...n)=>{let[s,...i]=bn(e);if(T(t)){let e=i.length>0?i[0]:n[0];return _(t,e)}return s.call(ms,...i,...n)}),null,"fn")})),gs=cs((({positional:e})=>{let t=e[0]??g,n=e[1]??g;return b((()=>{let e=k(t);if(Q(e))return oe(e,String(k(n)))}),(e=>{let s=k(t);if(Q(s))return ue(s,String(k(n)),e)}),"get")})),bs=cs((({named:e})=>{let t=b((()=>gn(e)),null,"hash"),n=new Map;for(let t in e)n.set(t,e[t]);return t.children=n,t}));function ks(e){return Ae(e.argsCache)}class ys{argsCache;constructor(e,t=(()=>xn)){let n=Re((()=>t(e)));this.argsCache=n}get named(){return ks(this).named||En}get positional(){return ks(this).positional||Cn}}function vs(e,t,n){const s=De(e),i=de(t).getDelegateFor(s);let r,a=new ys(e,n),l=i.createHelper(t,a);if(!be(i))throw new Error("TODO: unreachable, to be implemented with hasScheduledEffect");if(r=Re((()=>i.getValue(l))),ie(e,r),ke(i)){let e=i.getDestroyable(l);ie(r,e)}return r}X("`on` modifier");class Ss{tag=Me();element;args;listener=null;constructor(e,t){this.element=e,this.args=t,ne(this,(()=>{let{element:e,listener:t}=this;if(t){let{eventName:n,callback:s,options:i}=t;Cs(e,n,s,i)}}))}updateListener(){let{element:e,args:t,listener:n}=this;V(t.positional[0],"You must pass a valid DOM event name as the first argument to the `on` modifier");let s=k(t.positional[0]);V(t.positional[1],"You must pass a function as the second argument to the `on` modifier");let i,r,a,l=k(t.positional[1]);{let{once:e,passive:n,capture:s}=t.named;e&&(i=k(e)),n&&(r=k(n)),s&&(a=k(s))}let o,u=!1;if(u=null===n||s!==n.eventName||l!==n.userProvidedCallback||i!==n.once||r!==n.passive||a!==n.capture,u&&(void 0===i&&void 0===r&&void 0===a||(o={once:i,passive:r,capture:a})),u){let t=l;this.listener={eventName:s,callback:t,userProvidedCallback:l,once:i,passive:r,capture:a,options:o},n&&Cs(e,n.eventName,n.callback,n.options),function(e,t,n,s){ws++,e.addEventListener(t,n,s)}(e,s,t,o)}}}let ws=0,Es=0;function Cs(e,t,n,s){Es++,e.removeEventListener(t,n,s)}const xs=ye(new class{getDebugName(){return"on"}getDebugInstance(){return null}get counters(){return{adds:ws,removes:Es}}create(e,t,n,s){return new Ss(t,s)}getTag({tag:e}){return e}install(e){e.updateListener()}update(e){e.updateListener()}getDestroyable(e){return e}},{});class Ns{currentOpSize=0;constructor(e,t,n,s,i){this.stack=e,this.heap=t,this.program=n,this.externs=s,this.registers=i}fetchRegister(e){return this.registers[e]}loadRegister(e,t){this.registers[e]=t}setPc(e){V("number"==typeof e&&!isNaN(e),"pc is set to a number"),this.registers[t]=e}pushFrame(){this.stack.push(this.registers[c]),this.stack.push(this.registers[p]),this.registers[p]=this.registers[a]-1}popFrame(){this.registers[a]=this.registers[p]-1,this.registers[c]=this.stack.get(0),this.registers[p]=this.stack.get(1)}pushSmallFrame(){this.stack.push(this.registers[c])}popSmallFrame(){this.registers[c]=this.stack.pop()}goto(e){this.setPc(this.target(e))}target(e){return this.registers[t]+e-this.currentOpSize}call(e){V(e<4294967295,"Jumping to placeholder address"),this.registers[c]=this.registers[t],this.setPc(this.heap.getaddr(e))}returnTo(e){this.registers[c]=this.target(e)}return(){this.setPc(this.registers[c])}nextStatement(){let{registers:e,program:n}=this,s=e[t];if(V("number"==typeof s,"pc is a number"),-1===s)return null;let i=n.opcode(s),r=this.currentOpSize=i.size;return this.registers[t]+=r,i}evaluateOuter(e,t){this.evaluateInner(e,t)}evaluateInner(e,t){e.isMachine?this.evaluateMachine(e):this.evaluateSyscall(e,t)}evaluateMachine(e){switch(e.type){case d.PushFrame:return this.pushFrame();case d.PopFrame:return this.popFrame();case d.InvokeStatic:return this.call(e.op1);case d.InvokeVirtual:return this.call(this.stack.pop());case d.Jump:return this.goto(e.op1);case d.Return:return this.return();case d.ReturnTo:return this.returnTo(e.op1)}}evaluateSyscall(e,t){At.evaluate(t,e,e.type)}}class Ts{env;dom;alwaysRevalidate;frameStack=new L;constructor(e,{alwaysRevalidate:t=!1}){this.env=e,this.dom=e.getDOM(),this.alwaysRevalidate=t}execute(e,t){this._execute(e,t)}_execute(e,t){let{frameStack:n}=this;for(this.try(e,t);!n.isEmpty();){let e=this.frame.nextStatement();void 0!==e?e.evaluate(this):n.pop()}}get frame(){return M(this.frameStack.current,"bug: expected a frame")}goto(e){this.frame.goto(e)}try(e,t){this.frameStack.push(new Os(e,t))}throw(){this.frame.handleException(),this.frameStack.pop()}}class _s{constructor(e,t){this.state=e,this.resumeCallback=t}resume(e,t){return this.resumeCallback(e,this.state,t)}}class Bs{children;bounds;constructor(e,t,n,s){this.state=e,this.runtime=t,this.children=s,this.bounds=n}parentElement(){return this.bounds.parentElement()}firstNode(){return this.bounds.firstNode()}lastNode(){return this.bounds.lastNode()}evaluate(e){e.try(this.children,null)}}class Rs extends Bs{type="try";evaluate(e){e.try(this.children,this)}handleException(){let{state:e,bounds:t,runtime:n}=this;ae(this);let s=xt.resume(n.env,t),i=e.resume(n,s),r=[],a=this.children=[],l=i.execute((e=>{e.pushUpdating(r),e.updateWith(this),e.pushUpdating(a)}));ie(this,l.drop)}}class As extends Rs{retained=!1;index=-1;constructor(e,t,n,s,i,r){super(e,t,n,[]),this.key=s,this.memo=i,this.value=r}updateReferences(e){this.retained=!0,_(this.value,e.value),_(this.memo,e.memo)}shouldRemove(){return!this.retained}reset(){this.retained=!1}}class Ms extends Bs{type="list-block";opcodeMap=new Map;marker=null;lastIterator;constructor(e,t,n,s,i){super(e,t,n,s),this.iterableRef=i,this.lastIterator=k(i)}initializeChild(e){e.index=this.children.length-1,this.opcodeMap.set(e.key,e)}evaluate(e){let t=k(this.iterableRef);if(this.lastIterator!==t){let{bounds:n}=this,{dom:s}=e,i=this.marker=s.createComment("");s.insertAfter(n.parentElement(),i,M(n.lastNode(),"can't insert after an empty bounds")),this.sync(t),this.parentElement().removeChild(i),this.marker=null,this.lastIterator=t}super.evaluate(e)}sync(e){let{opcodeMap:t,children:n}=this,s=0,i=0;for(this.children=this.bounds.boundList=[];;){let r=e.next();if(null===r)break;let a=n[s],{key:l}=r;for(;void 0!==a&&!0===a.retained;)a=n[++s];if(void 0!==a&&a.key===l)this.retainItem(a,r),s++;else if(t.has(l)){let e=t.get(l);if(e.index<i)this.moveItem(e,r,a);else{i=e.index;let t=!1;for(let e=s+1;e<i;e++)if(!1===A(n[e]).retained){t=!0;break}!1===t?(this.retainItem(e,r),s=i+1):(this.moveItem(e,r,a),s++)}}else this.insertItem(r,a)}for(const e of n)!1===e.retained?this.deleteItem(e):e.reset()}retainItem(e,t){let{children:n}=this;_(e.memo,t.memo),_(e.value,t.value),e.retained=!0,e.index=n.length,n.push(e)}insertItem(e,t){let{opcodeMap:n,bounds:s,state:i,runtime:r,children:a}=this,{key:l}=e,o=void 0===t?this.marker:t.firstNode(),u=xt.forInitialRender(r.env,{element:s.parentElement(),nextSibling:o});i.resume(r,u).execute((t=>{t.pushUpdating();let s=t.enterItem(e);s.index=a.length,a.push(s),n.set(l,s),ie(this,s)}))}moveItem(e,t,n){let s,i,{children:r}=this;_(e.memo,t.memo),_(e.value,t.value),e.retained=!0,void 0===n?$e(e,this.marker):(s=e.lastNode().nextSibling,i=n.firstNode(),s!==i&&$e(e,i)),e.index=r.length,r.push(e)}deleteItem(e){se(e),Ye(e),this.opcodeMap.delete(e.key)}}class Os{current=0;constructor(e,t){this.ops=e,this.exceptionHandler=t}goto(e){this.current=e}nextStatement(){return this.ops[this.current++]}handleException(){this.exceptionHandler&&this.exceptionHandler.handleException()}}class Ds{constructor(e,t,n,s){this.env=e,this.updating=t,this.bounds=n,this.drop=s,ie(this,s),ne(this,(()=>Ye(this.bounds)))}rerender({alwaysRevalidate:e=!1}={alwaysRevalidate:!1}){let{env:t,updating:n}=this;new Ts(t,{alwaysRevalidate:e}).execute(n,this)}parentElement(){return this.bounds.parentElement()}firstNode(){return this.bounds.firstNode()}lastNode(){return this.bounds.lastNode()}handleException(){throw"this should never happen"}}class Ls{static restore(e){return new this(e.slice(),[0,-1,e.length-1,0])}[Pe];constructor(e=[],t){this.stack=e,this[Pe]=t}push(e){this.stack[++this[Pe][a]]=e}dup(e=this[Pe][a]){this.stack[++this[Pe][a]]=this.stack[e]}copy(e,t){this.stack[t]=this.stack[e]}pop(e=1){let t=this.stack[this[Pe][a]];return this[Pe][a]-=e,t}peek(e=0){return this.stack[this[Pe][a]-e]}get(e,t=this[Pe][p]){return this.stack[t+e]}set(e,t,n=this[Pe][p]){this.stack[n+t]=e}slice(e,t){return this.stack.slice(e,t)}capture(e){let t=this[Pe][a]+1,n=t-e;return this.stack.slice(n,t)}reset(){this.stack.length=0}toArray(){return this.stack.slice(this[Pe][p],this[Pe][a]+1)}}class Vs{scope=new L;dynamicScope=new L;updating=new L;cache=new L;list=new L}class Us{[He]=new Vs;[Ge];destructor;[Ie]=new L;[je];[ze];[Ue];get stack(){return this[Ue].stack}get pc(){return this[Ue].fetchRegister(t)}s0=null;s1=null;t0=null;t1=null;v0=null;fetch(e){let t=this.fetchValue(e);this.stack.push(t)}load(e){let t=this.stack.pop();this.loadValue(e,t)}fetchValue(e){if(h(e))return this[Ue].fetchRegister(e);switch(e){case f:return this.s0;case m:return this.s1;case s:return this.t0;case i:return this.t1;case l:return this.v0}}loadValue(e,t){switch(h(e)&&this[Ue].loadRegister(e,t),e){case f:this.s0=t;break;case m:this.s1=t;break;case s:this.t0=t;break;case i:this.t1=t;break;case l:this.v0=t}}pushFrame(){this[Ue].pushFrame()}popFrame(){this[Ue].popFrame()}goto(e){this[Ue].goto(e)}call(e){this[Ue].call(e)}returnTo(e){this[Ue].returnTo(e)}return(){this[Ue].return()}constructor(e,{pc:n,scope:s,dynamicScope:i,stack:r},l,o){this.runtime=e,this.elementStack=l,this.context=o,this.resume=Hs(o);let u=Ls.restore(r);V("number"==typeof n,"pc is a number"),u[Pe][t]=n,u[Pe][a]=r.length-1,u[Pe][p]=-1,this[Ge]=this.program.heap,this[je]=this.program.constants,this.elementStack=l,this[He].scope.push(s),this[He].dynamicScope.push(i),this[ze]=new ln,this[Ue]=new Ns(u,this[Ge],e.program,{debugBefore:e=>At.debugBefore(this,e),debugAfter:e=>{At.debugAfter(this,e)}},u[Pe]),this.destructor={},this[Ie].push(this.destructor)}static initial(e,t,{handle:n,self:s,dynamicScope:i,treeBuilder:r,numSymbols:a,owner:l}){let o=Ve.root(s,a,l),u=Is(e.program.heap.getaddr(n),o,i),c=Hs(t)(e,u,r);return c.pushUpdating(),c}static empty(e,{handle:t,treeBuilder:n,dynamicScope:s,owner:i},r){let a=Hs(r)(e,Is(e.program.heap.getaddr(t),Ve.root(g,0,i),s),n);return a.pushUpdating(),a}resume;compile(e){return Z(e.compile(this.context))}get program(){return this.runtime.program}get env(){return this.runtime.env}captureState(e,n=this[Ue].fetchRegister(t)){return{pc:n,scope:this.scope(),dynamicScope:this.dynamicScope(),stack:this.stack.capture(e)}}capture(e,n=this[Ue].fetchRegister(t)){return new _s(this.captureState(e,n),this.resume)}beginCacheGroup(e){let t=this.updating(),n=new $t;t.push(n),t.push(new Yt(e)),this[He].cache.push(n),ve(e)}commitCacheGroup(){let e=this.updating(),t=M(this[He].cache.pop(),"VM BUG: Expected a cache group"),n=Se();e.push(new Jt(t)),t.finalize(n,e.length)}enter(e){let t=this.capture(e),n=this.elements().pushUpdatableBlock(),s=new Rs(t,this.runtime,n,[]);this.didEnter(s)}enterItem({key:e,value:t,memo:n}){let{stack:s}=this,i=B(t),r=B(n);s.push(i),s.push(r);let a=this.capture(2),l=this.elements().pushUpdatableBlock(),o=new As(a,this.runtime,l,e,r,i);return this.didEnter(o),o}registerItem(e){this.listBlock().initializeChild(e)}enterList(e,t){let n=[],s=this[Ue].target(t),i=this.capture(0,s),r=this.elements().pushBlockList(n),a=new Ms(i,this.runtime,r,n,e);this[He].list.push(a),this.didEnter(a)}didEnter(e){this.associateDestroyable(e),this[Ie].push(e),this.updateWith(e),this.pushUpdating(e.children)}exit(){this[Ie].pop(),this.elements().popBlock(),this.popUpdating()}exitList(){this.exit(),this[He].list.pop()}pushUpdating(e=[]){this[He].updating.push(e)}popUpdating(){return M(this[He].updating.pop(),"can't pop an empty stack")}updateWith(e){this.updating().push(e)}listBlock(){return M(this[He].list.current,"expected a list block")}associateDestroyable(e){let t=M(this[Ie].current,"Expected destructor parent");ie(t,e)}tryUpdating(){return this[He].updating.current}updating(){return M(this[He].updating.current,"expected updating opcode on the updating opcode stack")}elements(){return this.elementStack}scope(){return M(this[He].scope.current,"expected scope on the scope stack")}dynamicScope(){return M(this[He].dynamicScope.current,"expected dynamic scope on the dynamic scope stack")}pushChildScope(){this[He].scope.push(this.scope().child())}pushDynamicScope(){let e=this.dynamicScope().child();return this[He].dynamicScope.push(e),e}pushRootScope(e,t){let n=Ve.sized(e,t);return this[He].scope.push(n),n}pushScope(e){this[He].scope.push(e)}popScope(){this[He].scope.pop()}popDynamicScope(){this[He].dynamicScope.pop()}getOwner(){return this.scope().owner}getSelf(){return this.scope().getSelf()}referenceForSymbol(e){return this.scope().getSymbol(e)}execute(e){return this._execute(e)}_execute(e){let t;e&&e(this);do{t=this.next()}while(!t.done);return t.value}next(){let e,{env:t,elementStack:n}=this,s=this[Ue].nextStatement();return null!==s?(this[Ue].evaluateOuter(s,this),e={done:!1,value:null}):(this.stack.reset(),e={done:!0,value:new Ds(t,this.popUpdating(),n.popBlock(),this.destructor)}),e}bindDynamicScope(e){let t=this.dynamicScope();for(const n of ee(e))t.set(n,this.stack.pop())}}function Is(e,t,n){return{pc:e,scope:t,dynamicScope:n,stack:[]}}function Hs(e){return(t,n,s)=>new Us(t,n,s,e)}class Ps{constructor(e){this.vm=e}next(){return this.vm.next()}sync(){return this.vm.execute()}}function Gs(e,t){let n;return us(e,(()=>n=t.sync())),n}function js(e,t,n,s,i,r,a=new Le){let l=Z(r.compile(t)),o=r.symbolTable.symbols.length,u=Us.initial(e,t,{self:s,dynamicScope:a,treeBuilder:i,handle:l,numSymbols:o,owner:n});return new Ps(u)}function zs(e,t,n,s,i,r={},a=new Le){return function(e,t,n,s,i){const r=Object.keys(i).map((e=>[e,i[e]])),a=["main","else","attrs"],l=r.map((([e])=>`@${e}`));let o=e[je].component(s,n);e.pushFrame();for(let t=0;t<3*a.length;t++)e.stack.push(null);e.stack.push(null),r.forEach((([,t])=>{e.stack.push(t)})),e[ze].setup(e.stack,l,a,0,!0);const u=M(o.compilable,"BUG: Expected the root component rendered with renderComponent to have an associated template, set with setComponentTemplate"),c={handle:Z(u.compile(t)),symbolTable:u.symbolTable};return e.stack.push(e[ze]),e.stack.push(c),e.stack.push(o),new Ps(e)}(Us.empty(e,{treeBuilder:t,handle:n.stdlib.main,dynamicScope:a,owner:s},n),n,s,i,function(e){const t=y(e,"args");return Object.keys(e).reduce(((e,n)=>(e[n]=x(t,n),e)),{})}(r))}const Fs="%+b:0%";function Ws(e){return e.nodeValue===Fs}class $s extends Fe{candidate=null;openBlockDepth;injectedOmittedNode=!1;constructor(e,t,n){super(e,t),this.startingBlockDepth=n,this.openBlockDepth=n-1}}class Ys extends xt{unmatchedAttributes=null;blockDepth=0;startingBlockOffset;constructor(e,t,n){if(super(e,t,n),n)throw new Error("Rehydration with nextSibling not supported");let s=this.currentCursor.element.firstChild;for(;null!==s&&!Js(s);)s=s.nextSibling;V(s,"Must have opening comment for rehydration."),this.candidate=s;const i=qs(s);if(0!==i){const e=i-1,t=this.dom.createComment(`%+b:${e}%`);s.parentNode.insertBefore(t,this.candidate);let n=s.nextSibling;for(;null!==n&&(!Ks(n)||qs(n)!==i);)n=n.nextSibling;V(n,"Must have closing comment for starting block comment");const r=this.dom.createComment(`%-b:${e}%`);s.parentNode.insertBefore(r,n.nextSibling),this.candidate=t,this.startingBlockOffset=e}else this.startingBlockOffset=0}get currentCursor(){return this[Ct].current}get candidate(){return this.currentCursor?this.currentCursor.candidate:null}set candidate(e){this.currentCursor.candidate=e}disableRehydration(e){const t=this.currentCursor;t.candidate=null,t.nextSibling=e}enableRehydration(e){const t=this.currentCursor;t.candidate=e,t.nextSibling=null}pushElement(e,t=null){const n=new $s(e,t,this.blockDepth||0);null!==this.candidate&&(n.candidate=e.firstChild,this.candidate=e.nextSibling),this[Ct].push(n)}clearMismatch(e){let t=e;const n=this.currentCursor;if(null!==n){const e=n.openBlockDepth;if(e>=n.startingBlockDepth)for(;t&&!(Ks(t)&&e>=Xs(t,this.startingBlockOffset));)t=this.remove(t);else for(;null!==t;)t=this.remove(t);this.disableRehydration(t)}}__openBlock(){const{currentCursor:e}=this;if(null===e)return;const t=this.blockDepth;this.blockDepth++;const{candidate:n}=e;if(null===n)return;const{tagName:s}=e.element;Js(n)&&Xs(n,this.startingBlockOffset)===t?(this.candidate=this.remove(n),e.openBlockDepth=t):"TITLE"!==s&&"SCRIPT"!==s&&"STYLE"!==s&&this.clearMismatch(n)}__closeBlock(){const{currentCursor:e}=this;if(null===e)return;const t=e.openBlockDepth;this.blockDepth--;const{candidate:n}=e;let s=!1;if(null!==n)if(s=!0,Ks(n)&&Xs(n,this.startingBlockOffset)===t){const t=this.remove(n);this.candidate=t,e.openBlockDepth--}else this.clearMismatch(n),s=!1;if(!1===s){const t=e.nextSibling;if(null!==t&&Ks(t)&&Xs(t,this.startingBlockOffset)===this.blockDepth){const n=this.remove(t);this.enableRehydration(n),e.openBlockDepth--}}}__appendNode(e){const{candidate:t}=this;return t||super.__appendNode(e)}__appendHTML(e){const t=this.markerBounds();if(t){const e=t.firstNode(),n=t.lastNode(),s=new We(this.element,e.nextSibling,n.previousSibling),i=this.remove(e);return this.remove(n),null!==i&&ei(i)&&(this.candidate=this.remove(i),null!==this.candidate&&this.clearMismatch(this.candidate)),s}return super.__appendHTML(e)}remove(e){const t=M(e.parentNode,"cannot remove a detached node"),n=e.nextSibling;return t.removeChild(e),n}markerBounds(){const e=this.candidate;if(e&&Zs(e)){const t=e;let n=M(t.nextSibling,"BUG: serialization markers must be paired");for(;n&&!Zs(n);)n=M(n.nextSibling,"BUG: serialization markers must be paired");return new We(this.element,t,n)}return null}__appendText(e){const{candidate:t}=this;return t?3===t.nodeType?(t.nodeValue!==e&&(t.nodeValue=e),this.candidate=t.nextSibling,t):8===(n=t).nodeType&&"%|%"===n.nodeValue||ei(t)&&""===e?(this.candidate=this.remove(t),this.__appendText(e)):(this.clearMismatch(t),super.__appendText(e)):super.__appendText(e);var n}__appendComment(e){const t=this.candidate;return t&&8===t.nodeType?(t.nodeValue!==e&&(t.nodeValue=e),this.candidate=t.nextSibling,t):(t&&this.clearMismatch(t),super.__appendComment(e))}__openElement(e){const t=this.candidate;if(t&&Qs(t)&&function(e,t){return e.namespaceURI===O?e.tagName===t:e.tagName===t.toUpperCase()}(t,e))return this.unmatchedAttributes=[].slice.call(t.attributes),t;if(t){if(Qs(t)&&"TBODY"===t.tagName)return this.pushElement(t,null),this.currentCursor.injectedOmittedNode=!0,this.__openElement(e);this.clearMismatch(t)}return super.__openElement(e)}__setAttribute(e,t,n){const s=this.unmatchedAttributes;if(s){const n=ti(s,e);if(n)return n.value!==t&&(n.value=t),void s.splice(s.indexOf(n),1)}return super.__setAttribute(e,t,n)}__setProperty(e,t){const n=this.unmatchedAttributes;if(n){const s=ti(n,e);if(s)return s.value!==t&&(s.value=t),void n.splice(n.indexOf(s),1)}return super.__setProperty(e,t)}__flushElement(e,t){const{unmatchedAttributes:n}=this;if(n){for(const e of n)this.constructing.removeAttribute(e.name);this.unmatchedAttributes=null}else super.__flushElement(e,t)}willCloseElement(){const{candidate:e,currentCursor:t}=this;null!==e&&this.clearMismatch(e),t&&t.injectedOmittedNode&&this.popElement(),super.willCloseElement()}getMarker(e,t){const n=e.querySelector(`script[glmr="${t}"]`);return n?q(n):null}__pushRemoteElement(e,t,n){const s=this.getMarker(D(e,"HTML"),t);if(V(!s||s.parentNode===e,"expected remote element marker's parent node to match remote element"),void 0===n){for(;null!==e.firstChild&&e.firstChild!==s;)this.remove(e.firstChild);n=null}const i=new $s(e,null,this.blockDepth);this[Ct].push(i),null===s?this.disableRehydration(n):this.candidate=this.remove(s);const r=new Tt(e);return this.pushLiveBlock(r,!0)}didAppendBounds(e){if(super.didAppendBounds(e),this.candidate){const t=e.lastNode();this.candidate=t&&t.nextSibling}return e}}function Js(e){return e.nodeType===te&&0===e.nodeValue.lastIndexOf("%+b:",0)}function Ks(e){return e.nodeType===te&&0===e.nodeValue.lastIndexOf("%-b:",0)}function qs(e){return parseInt(e.nodeValue.slice(4),10)}function Xs(e,t){return qs(e)-t}function Qs(e){return 1===e.nodeType}function Zs(e){return 8===e.nodeType&&"%glmr%"===e.nodeValue}function ei(e){return 8===e.nodeType&&"% %"===e.nodeValue}function ti(e,t){for(const n of e)if(n.name===t)return n}function ni(e,t){return Ys.forInitialRender(e,t)}export{We as ConcreteBounds,Pt as CurriedValue,Fe as CursorImpl,ts as DOMChanges,Kn as DOMTreeConstruction,mt as DynamicAttribute,Le as DynamicScopeImpl,xn as EMPTY_ARGS,En as EMPTY_NAMED,Cn as EMPTY_POSITIONAL,ls as EnvironmentImpl,Zn as IDOMChanges,Us as LowLevelVM,xt as NewElementBuilder,Ve as PartialScopeImpl,Ys as RehydrateBuilder,Tt as RemoteLiveBlock,Fs as SERIALIZATION_FIRST_NODE_STRING,ft as SimpleDynamicAttribute,Hn as TEMPLATE_ONLY_COMPONENT_MANAGER,Pn as TemplateOnlyComponent,In as TemplateOnlyComponentManager,_t as UpdatableBlockImpl,Ts as UpdatingVM,ps as array,Ye as clear,Rt as clientBuilder,hs as concat,fn as createCapturedArgs,jt as curry,dt as dynamicAttribute,fs as fn,gs as get,bs as hash,us as inTransaction,vs as invokeHelper,Ws as isSerializationFirstNode,Qn as isWhitespace,Ze as normalizeProperty,xs as on,ni as rehydrationBuilder,kn as reifyArgs,gn as reifyNamed,bn as reifyPositional,zs as renderComponent,js as renderMain,Gs as renderSync,Ln as resetDebuggerCallback,os as runtimeContext,Dn as setDebuggerCallback,Gn as templateOnlyComponent};
//# sourceMappingURL=index.js.map
