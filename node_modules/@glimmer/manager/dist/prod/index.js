import{associateDestroyableChild as e,registerDestructor as t}from"@glimmer/destroyable";import{valueForRef as n,createComputeRef as r,createConstRef as o,UNDEFINED_REFERENCE as a}from"@glimmer/reference";import{track as i,createUpdatableTag as l,untrack as u}from"@glimmer/validator";import{Op as s,InternalComponentCapabilities as c}from"@glimmer/vm";import{castToBrowser as f}from"@glimmer/util";const g=new WeakMap;function d(e){return g.get(e)}function p(e,t){g.set(e,t)}function m(e){if("symbol"==typeof e)return null;const t=Number(e);return isNaN(t)?null:t%1==0?t:null}class h{constructor(e){this.named=e}get(e,t){const r=this.named[t];if(void 0!==r)return n(r)}has(e,t){return t in this.named}ownKeys(){return Object.keys(this.named)}isExtensible(){return!1}getOwnPropertyDescriptor(e,t){return{enumerable:!0,configurable:!0}}}class y{constructor(e){this.positional=e}get(e,t){let{positional:r}=this;if("length"===t)return r.length;const o=m(t);return null!==o&&o<r.length?n(r[o]):e[t]}isExtensible(){return!1}has(e,t){const n=m(t);return null!==n&&n<this.positional.length}}const b=(e,t)=>{const{named:r,positional:o}=e,a=new h(r),l=new y(o),u=Object.create(null),s=new Proxy(u,a),c=new Proxy([],l);return p(s,((e,t)=>function(e,t){return i((()=>{t in e&&n(e[t])}))}(r,t))),p(c,((e,t)=>function(e,t){return i((()=>{"[]"===t&&e.forEach(n);const r=m(t);null!==r&&r<e.length&&n(e[r])}))}(o,t))),{named:s,positional:c}};new Array(s.Size).fill(null),new Array(s.Size).fill(null);const D=c.Empty;function w(e){return D|k(e,"dynamicLayout")|k(e,"dynamicTag")|k(e,"prepareArgs")|k(e,"createArgs")|k(e,"attributeHook")|k(e,"elementHook")|k(e,"dynamicScope")|k(e,"createCaller")|k(e,"updateHook")|k(e,"createInstance")|k(e,"wrapped")|k(e,"willDestroy")|k(e,"hasSubOwner")}function k(e,t){return e[t]?c[t]:D}function M(e,t,n){return!!(t&n)}function v(e,t){return!!(e&t)}function C(e,t={}){return{hasValue:Boolean(t.hasValue),hasDestroyable:Boolean(t.hasDestroyable),hasScheduledEffect:Boolean(t.hasScheduledEffect)}}function E(e){return e.capabilities.hasValue}function H(e){return e.capabilities.hasDestroyable}class O{constructor(e){this.factory=e}helperManagerDelegates=new WeakMap;undefinedDelegate=null;getDelegateForOwner(e){let t=this.helperManagerDelegates.get(e);if(void 0===t){let{factory:n}=this;t=n(e),this.helperManagerDelegates.set(e,t)}return t}getDelegateFor(e){if(void 0===e){let{undefinedDelegate:e}=this;if(null===e){let{factory:t}=this;this.undefinedDelegate=e=t(void 0)}return e}return this.getDelegateForOwner(e)}getHelper(t){return(n,i)=>{let l=this.getDelegateFor(i);const u=b(n),s=l.createHelper(t,u);if(E(l)){let t=r((()=>l.getValue(s)),null,!1);return H(l)&&e(t,l.getDestroyable(s)),t}if(H(l)){let t=o(void 0,!1);return e(t,l.getDestroyable(s)),t}return a}}}class S{capabilities={hasValue:!0,hasDestroyable:!1,hasScheduledEffect:!1};createHelper(e,t){return{fn:e,args:t}}getValue({fn:e,args:t}){return Object.keys(t.named).length>0?e(...t.positional,t.named):e(...t.positional)}getDebugName(e){return e.name?`(helper function ${e.name})`:"(anonymous helper function)"}}const A=new WeakMap,L=new WeakMap,T=new WeakMap,F=Object.getPrototypeOf;function N(e,t,n){return e.set(n,t),n}function W(e,t){let n=t;for(;null!=n;){const t=e.get(n);if(void 0!==t)return t;n=F(n)}}function B(e,t){return N(L,e,t)}function x(e,t){const n=W(L,e);return void 0===n&&!0===t?null:n}function V(e,t){return N(T,e,t)}const j=new O((()=>new S));function P(e,t){let n=W(T,e);return void 0===n&&"function"==typeof e&&(n=j),n||null}function I(e,t){return N(A,e,t)}function U(e,t){const n=W(A,e);return void 0===n&&!0===t?null:n}function z(e){return void 0!==W(A,e)}function K(e){return function(e){return"function"==typeof e}(e)||void 0!==W(T,e)}function R(e){return void 0!==W(L,e)}const $={dynamicLayout:!1,dynamicTag:!1,prepareArgs:!1,createArgs:!0,attributeHook:!1,elementHook:!1,createCaller:!1,dynamicScope:!0,updateHook:!0,createInstance:!0,wrapped:!1,willDestroy:!1,hasSubOwner:!1};function q(e,t={}){let n=Boolean(t.updateHook);return{asyncLifeCycleCallbacks:Boolean(t.asyncLifecycleCallbacks),destructor:Boolean(t.destructor),updateHook:n}}function G(e){return e.capabilities.asyncLifeCycleCallbacks}function J(e){return e.capabilities.updateHook}class Q{componentManagerDelegates=new WeakMap;constructor(e){this.factory=e}getDelegateFor(e){let{componentManagerDelegates:t}=this,n=t.get(e);if(void 0===n){let{factory:r}=this;n=r(e),t.set(e,n)}return n}create(e,t,n){let r=this.getDelegateFor(e),o=b(n.capture()),a=r.createComponent(t,o);return new X(a,r,o)}getDebugName(e){return"function"==typeof e?e.name:e.toString()}update(e){let{delegate:t}=e;if(J(t)){let{component:n,args:r}=e;t.updateComponent(n,r)}}didCreate({component:e,delegate:t}){G(t)&&t.didCreateComponent(e)}didUpdate({component:e,delegate:t}){(function(e){return G(e)&&J(e)})(t)&&t.didUpdateComponent(e)}didRenderLayout(){}didUpdateLayout(){}getSelf({component:e,delegate:t}){return o(t.getContext(e),"this")}getDestroyable(e){const{delegate:n}=e;if(function(e){return e.capabilities.destructor}(n)){const{component:r}=e;return t(e,(()=>n.destroyComponent(r))),e}return null}getCapabilities(){return $}}class X{constructor(e,t,n){this.component=e,this.delegate=t,this.args=n}}function Y(e,t={}){return{disableAutoTracking:Boolean(t.disableAutoTracking)}}class Z{componentManagerDelegates=new WeakMap;constructor(e){this.factory=e}getDelegateFor(e){let{componentManagerDelegates:t}=this,n=t.get(e);if(void 0===n){let{factory:r}=this;n=r(e),t.set(e,n)}return n}create(e,n,r,o){let a,i=this.getDelegateFor(e),u=b(o),s=i.createModifier(r,u);return a={tag:l(),element:n,delegate:i,args:u,modifier:s},t(a,(()=>i.destroyModifier(s,u))),a}getDebugName(e){return"function"==typeof e?e.name||e.toString():"<unknown>"}getDebugInstance({modifier:e}){return e}getTag({tag:e}){return e}install({element:e,args:t,modifier:n,delegate:r}){let{capabilities:o}=r;!0===o.disableAutoTracking?u((()=>r.installModifier(n,f(e,"ELEMENT"),t))):r.installModifier(n,f(e,"ELEMENT"),t)}update({args:e,modifier:t,delegate:n}){let{capabilities:r}=n;!0===r.disableAutoTracking?u((()=>n.updateModifier(t,e))):n.updateModifier(t,e)}getDestroyable(e){return e}}function _(e,t){return I(new Q(e),t)}function ee(e,t){return B(new Z(e),t)}function te(e,t){return V(new O(e),t)}const ne=new WeakMap,re=Object.getPrototypeOf;function oe(e,t){return ne.set(t,e),t}function ae(e){let t=e;for(;null!==t;){let e=ne.get(t);if(void 0!==e)return e;t=re(t)}}export{Q as CustomComponentManager,O as CustomHelperManager,Z as CustomModifierManager,w as capabilityFlagsFrom,q as componentCapabilities,ae as getComponentTemplate,d as getCustomTagFor,U as getInternalComponentManager,P as getInternalHelperManager,x as getInternalModifierManager,v as hasCapability,H as hasDestroyable,z as hasInternalComponentManager,K as hasInternalHelperManager,R as hasInternalModifierManager,E as hasValue,C as helperCapabilities,M as managerHasCapability,Y as modifierCapabilities,_ as setComponentManager,oe as setComponentTemplate,p as setCustomTagFor,te as setHelperManager,I as setInternalComponentManager,V as setInternalHelperManager,B as setInternalModifierManager,ee as setModifierManager};
//# sourceMappingURL=index.js.map
